if (self.CavalryLogger) { CavalryLogger.start_js(["QDUcY"]); }

__d("MqttLongPollingClient",["MqttLogger","XHRRequest","getCrossOriginTransport","paho-mqtt"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("paho-mqtt").Decoder,h=60*1e3;a=function(){__p&&__p();function a(a,c,d,e){this.$2=a,this.$3=b("MqttLogger").getInstance(),this.$1="Ready",this.$4=c,this.$5=d,this.$6=e,this.$7=null}var c=a.prototype;c.run=function(){this.$8(this.$4)};c.abort=function(){this.$7!=null&&this.$7.abort("Disconnected")};c.$9=function(a,b){if(this.$1===a)return;this.$1=a;a=="Error"&&b!=null&&this.$6(b)};c.$10=function(a){__p&&__p();if(this.$1!="RequestSend")return;if(!a){this.$11("EmptyResponse",null);return}this.$9("ResponseReceived");a=g.decode(a);a=a.filter(function(a){return a.payloadMessage}).map(function(a){return a.payloadMessage});this.$5(a)};c.$11=function(a,b){b=b!=null?b.message:"null";this.$3.debugTrace("LongPollingClient Error","Poll failed with error:"+a+", errorMsg:"+b);this.$9("Error",a)};c.$8=function(a){__p&&__p();var c=this;if(this.$1!="Ready"||this.$7)return;this.$7=new(b("XHRRequest"))(this.$2).setResponseType("arraybuffer").setRawData(a).setTransportBuilder(b("getCrossOriginTransport").withCredentials).setResponseHandler(function(a){return c.$10(a)}).setNetworkFailureHandler(function(a){c.$11("Network",a)}).setErrorHandler(function(a){c.$11("Error",a)}).setAbortHandler(function(a){c.$11("Abort",null)}).setTimeoutHandler(function(){c.$11("Timeout",null)}).setTimeout(h).send();this.$9("RequestSend")};return a}();e.exports=a}),null);
__d("WebSocketAvailability",["UserAgent","keyMirror"],(function(a,b,c,d,e,f){"use strict";var g=b("keyMirror")({NotAvailable:null,LikelyNotAvailable:null,Available:null});function c(){if(!("WebSocket"in a&&a.WebSocket!==null))return g.NotAvailable;return b("UserAgent").isBrowser("Mobile Safari")&&b("UserAgent").isBrowser("Mobile Safari < 6")?g.LikelyNotAvailable:g.Available}e.exports={WSAvailabilities:g,getWSAvailability:c}}),null);
__d("MqttLongPollingRunner",["MqttLogger","MqttLongPollingClient","Random","WebSocketAvailability","exponentialBackoff","gkx","setTimeoutAcrossTransitions"],(function(a,b,c,d,e,f){"use strict";__p&&__p();var g=b("WebSocketAvailability").getWSAvailability,h=b("WebSocketAvailability").WSAvailabilities,i=new Set(["/t_ms","/messenger_sync_get_diffs","/messenger_sync_create_queue"]);a=function(){__p&&__p();function a(a,c,d,e,f,h){__p&&__p();var j=this;this.$16=function(){__p&&__p();if(!j.$18())return;var a=j.$8(),c=j.$9();a=a.filter(function(a){return i.has(a)});c=c.filter(function(a){return i.has(a.topic)});var d=Math.floor(b("Random").random()*Number.MAX_SAFE_INTEGER);d=j.$6.gen(d,a,c);if(a.length==0&&c.length==0){j.$4.debugTrace("LongPollingRunner","Poll skipped, nothing to do");b("setTimeoutAcrossTransitions")(function(){j.$16()},1e3);return}j.$14=new(b("MqttLongPollingClient"))(j.$5,d,function(a){return j.$19(a)},function(a){return j.$20(a)});j.$14.run();d=a.join(",");a=c.map(function(a){return a.topic}).join(",");j.$4.debugTrace("LongPollingRunner","Making a poll request to "+j.$5+". SubscribedTopics:"+d+". Publishes:"+a)};this.$5=a;this.$6=c;this.$1=!1;this.$2=0;this.$3=g();this.$4=b("MqttLogger").getInstance();this.$7=d;this.$8=e;this.$9=f;this.$10=h;this.$11=0;this.$12=0;this.$13=!1;this.$14=null;this.$15=new(b("exponentialBackoff"))(this.$16,this)}var c=a.prototype;c.start=function(){this.$16()};c.onConnectAttempt=function(){};c.onConnectFailure=function(){this.$2++,this.$16()};c.onConnected=function(){};c.onConnectSuccess=function(){this.$1=!0};c.onConnectionLost=function(){};c.onSubscribe=function(a){};c.onUnsubscribe=function(a){};c.onPublish=function(a){};c.onMessage=function(a){};c.$17=function(){__p&&__p();var a=b("gkx")("865724"),c=b("gkx")("865725");this.$4.debugTrace("LongPollingRunner","_shouldPoll? forcedPoll:"+String(a)+" enabled:"+String(c)+" wsAvailability:"+String(this.$3)+" hasSuccess:"+String(this.$1)+" failureCount:"+this.$2);if(a)return!0;if(!c)return!1;if(this.$3===h.NotAvailable)return!0;if(this.$1)return!1;if(this.$3===h.LikelyNotAvailable&&this.$2>=2)return!0;return this.$2>=5?!0:!1};c.$18=function(){if(this.$14!=null)return!1;var a=this.$17();!this.$13&&a&&this.$4.bumpCounter("polling_kickin");this.$13&&!a&&this.$4.bumpCounter("polling_stopped");return a};c.$19=function(a){__p&&__p();var b=a.map(function(a){return a.destinationName}).join(",");this.$4.debugTrace("LongPollingRunner","Poll request success, message received:"+b);for(var b=a,a=Array.isArray(b),c=0,b=a?b:b[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var d;if(a){if(c>=b.length)break;d=b[c++]}else{c=b.next();if(c.done)break;d=c.value}d=d;this.$7(d.destinationName,d.payloadString)}this.$11===0&&this.$4.bumpCounter("polling_first_success");this.$11++;this.$14=null;this.$15.reset();this.$16()};c.$20=function(a){this.$12++,this.$14=null,this.$15()};return a}();e.exports=a}),null);